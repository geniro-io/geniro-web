import axios from 'axios';

import {
  AnalyticsApi,
  Configuration,
  GitRepositoriesApi,
  GraphRevisionsApi,
  GraphsApi,
  KnowledgeApi,
  LitellmApi,
  ProjectsApi,
  RuntimesApi,
  SystemApi,
  TemplatesApi,
  ThreadsApi,
} from './autogenerated';
import { API_URL } from './config';

// Inject x-project-id header on every request based on the current URL.
// Reading from window.location at request time avoids race conditions with
// useEffect-based approaches and survives header object replacements in auth.
axios.interceptors.request.use((config) => {
  const match = window.location.pathname.match(/\/projects\/([^/]+)/);
  if (match?.[1]) {
    config.headers['x-project-id'] = match[1];
  }
  return config;
});

const configuration = new Configuration({
  basePath: API_URL,
});

export const graphsApi = new GraphsApi(configuration);
export const templatesApi = new TemplatesApi(configuration);
export const threadsApi = new ThreadsApi(configuration);
export const graphRevisionsApi = new GraphRevisionsApi(configuration);
export const litellmApi = new LitellmApi(configuration);
export const knowledgeApi = new KnowledgeApi(configuration);
export const gitRepositoriesApi = new GitRepositoriesApi(configuration);
export const analyticsApi = new AnalyticsApi(configuration);
export const runtimesApi = new RuntimesApi(configuration);
export const projectsApi = new ProjectsApi(configuration);
export const systemApi = new SystemApi(configuration);
